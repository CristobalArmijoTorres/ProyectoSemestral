"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2155],{2155:(L,f,l)=>{l.r(f),l.d(f,{LeerQrPageModule:()=>E});var h=l(177),u=l(4341),c=l(791),p=l(224),v=l(8465),e=l(3953),Q=l(8810),I=l(9437),M=l(1626);let C=(()=>{var t;class d{constructor(n){this.http=n,this.apiUrl="http://localhost:3000/asistencias"}registrarAsistencia(n,r,o){const s=(new Date).toLocaleDateString(),i={id:Math.random().toString(36).substring(2,6),asignaturaId:n,estudianteId:r,seccionId:o,fecha:s,estado:!0};return this.http.post(this.apiUrl,i).pipe((0,I.W)(a=>(console.error("Error al registrar asistencia",a),(0,Q.$)(a))))}}return(t=d).\u0275fac=function(n){return new(n||t)(e.KVO(M.Qq))},t.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"}),d})();const m=["action"];function b(t,d){if(1&t&&(e.j41(0,"div",12)(1,"p"),e.EFF(2),e.k0s()()),2&t){const g=e.XpG();e.R7$(2),e.JRh(g.errorMessage)}}const P=[{path:"",component:(()=>{var t;class d{constructor(n,r){this.qrcode=n,this.qrService=r,this.config={constraints:{video:{width:window.innerWidth}}},this.qrCodeInput="",this.errorMessage=""}ngAfterViewInit(){this.action.isReady.subscribe(n=>{console.log("QR Scanner Ready:",n)})}onEvent(n,r){if(n.length>0){const o=n[0].data;console.log("QR Data:",o),console.log("Tipo de QR Data:",typeof o),o instanceof Int8Array?(this.qrCodeInput=(new TextDecoder).decode(o),console.log("QR Code scanned:",this.qrCodeInput)):"string"==typeof o?(this.qrCodeInput=o,console.log("QR Code scanned:",this.qrCodeInput)):(console.error("El contenido del QR no es un string v\xe1lido."),this.errorMessage="El contenido del QR no es v\xe1lido.")}}handle(n,r){"start"===r?n[r](s=>{const i=s.find(a=>/back|rear|environment/gi.test(a.label));n.playDevice(i?i.deviceId:s[0].deviceId)}).subscribe(s=>console.log(r,s),s=>console.error(s)):n[r]().subscribe(s=>console.log(r,s),s=>console.error(s))}registrarAsistencia(){try{const n=JSON.parse(this.qrCodeInput);if(console.log("Datos del QR:",n),n&&n.asignaturaId&&n.seccionId){const r=JSON.parse(localStorage.getItem("user")||"{}"),o=null==r?void 0:r.id;if(!o)return void(this.errorMessage="No se pudo obtener el ID del estudiante. Revisa los datos del usuario.");const s=this.getSeccion(n.seccionId);if(!s)return void(this.errorMessage="Secci\xf3n no v\xe1lida.");if(!s.estudiantes.find(a=>a.estudianteId===o))return void(this.errorMessage="No puedes registrar asistencia. No perteneces a esta secci\xf3n.");this.qrService.registrarAsistencia(n.asignaturaId,o,n.seccionId).subscribe(a=>{console.log("Asistencia registrada:",a)},a=>{console.error("Error al registrar asistencia",a),this.errorMessage=a.message||"No se pudo registrar la asistencia. Int\xe9ntalo de nuevo."})}else this.errorMessage="C\xf3digo QR no v\xe1lido. Aseg\xfarate de que el QR contenga la informaci\xf3n requerida."}catch(n){console.error("Error al parsear el QR:",n),this.errorMessage="El formato del c\xf3digo QR es incorrecto."}}getSeccion(n){return[{id:"A",estudiantes:[{estudianteId:"3",nombre:"Usuario2"}]},{id:"B",estudiantes:[{estudianteId:"4",nombre:"Usuario1"}]}].find(o=>o.id===n)}}return(t=d).\u0275fac=function(n){return new(n||t)(e.rXU(p.dU),e.rXU(C))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-leer-qr"]],viewQuery:function(n,r){if(1&n&&e.GBs(m,5),2&n){let o;e.mGM(o=e.lsd())&&(r.action=o.first)}},decls:21,vars:6,consts:[["action","scanner"],[3,"translucent"],["slot","start"],["defaultHref","menu"],[1,"ion-padding",3,"fullscreen"],[3,"event","config"],[1,"ion-padding"],["ion-button","",3,"click"],["position","floating"],["readonly","",3,"ngModelChange","ngModel"],["expand","full",3,"click","disabled"],["class","ion-padding","color","danger",4,"ngIf"],["color","danger",1,"ion-padding"]],template:function(n,r){if(1&n){const o=e.RV6();e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Escaneo de QR"),e.k0s(),e.j41(4,"ion-buttons",2),e.nrm(5,"ion-back-button",3),e.k0s()()(),e.j41(6,"ion-content",4)(7,"ngx-scanner-qrcode",5,0),e.bIt("event",function(i){e.eBV(o);const a=e.sdS(8);return e.Njj(r.onEvent(i,a))}),e.k0s(),e.j41(9,"div",6)(10,"button",7),e.bIt("click",function(){e.eBV(o);const i=e.sdS(8);return e.Njj(r.handle(i,"start"))}),e.EFF(11,"Iniciar Escaneo"),e.k0s(),e.j41(12,"button",7),e.bIt("click",function(){e.eBV(o);const i=e.sdS(8);return e.Njj(r.handle(i,"stop"))}),e.EFF(13,"Detener Escaneo"),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label",8),e.EFF(16,"C\xf3digo QR Escaneado"),e.k0s(),e.j41(17,"ion-input",9),e.mxI("ngModelChange",function(i){return e.eBV(o),e.DH7(r.qrCodeInput,i)||(r.qrCodeInput=i),e.Njj(i)}),e.k0s()(),e.j41(18,"ion-button",10),e.bIt("click",function(){return e.eBV(o),e.Njj(r.registrarAsistencia())}),e.EFF(19,"Registrar Asistencia"),e.k0s(),e.DNE(20,b,3,1,"div",11),e.k0s()}2&n&&(e.Y8G("translucent",!0),e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("config",r.config),e.R7$(10),e.R50("ngModel",r.qrCodeInput),e.R7$(),e.Y8G("disabled",!r.qrCodeInput),e.R7$(2),e.Y8G("ngIf",r.errorMessage))},dependencies:[h.bT,u.BC,u.vS,c.Jm,c.QW,c.W9,c.eU,c.$w,c.uz,c.he,c.BC,c.ai,c.Gw,c.el,p.tc],styles:["h1[_ngcontent-%COMP%], h5[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{font-weight:600;word-break:break-all;font-family:Courier New,Courier,monospace}div[_ngcontent-%COMP%]{text-align:center;background:#fdfdfd}div[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:50%;height:60px;width:60px;margin:4px}div[_ngcontent-%COMP%]   buttondisabled[_ngcontent-%COMP%]{cursor:no-drop}div[_ngcontent-%COMP%]   .data[_ngcontent-%COMP%]{background:#faebd7;border-radius:5px}.origin-overlay[_ngcontent-%COMP%]   .qrcode-tooltip[_ngcontent-%COMP%]   .qrcode-tooltip-temp[_ngcontent-%COMP%]{padding:5px!important}"]}),d})()}];let R=(()=>{var t;class d{}return(t=d).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[v.iI.forChild(P),v.iI]}),d})(),E=(()=>{var t;class d{}return(t=d).\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[h.MD,u.YN,c.bv,p.gq,R]}),d})()}}]);